generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  role      UserRole  @default(USER)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  comandas  Comanda[]
}

model Produto {
  id           Int             @id @default(autoincrement())
  name         String
  description  String?
  category     ProductCategory
  priceCents   Int
  active       Boolean         @default(true)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  comandaItems ComandaItem[]
  estoque      Estoque?
}

model Estoque {
  id            Int      @id @default(autoincrement())
  produtoId     Int      @unique
  quantidade    Int      @default(0)
  minQuantidade Int      @default(0)
  updatedAt     DateTime @updatedAt
  produto       Produto  @relation(fields: [produtoId], references: [id])
}

model Racha {
  id         Int      @id @default(autoincrement())
  field      String
  date       DateTime
  hour       Int
  scheduled  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  userName   String?
  ativo      Boolean  @default(true)
  diaSemana  Int?
  recorrente Boolean  @default(false)

  @@unique([date, hour, field])
}

model Comanda {
  id           Int            @id @default(autoincrement())
  userId       Int?
  openedAt     DateTime       @default(now())
  closedAt     DateTime?
  totalCents   Int            @default(0)
  payment      PaymentMethod?
  notes        String?
  customerName String?
  user         User?          @relation(fields: [userId], references: [id])
  items        ComandaItem[]
}

model ComandaItem {
  id          Int      @id @default(autoincrement())
  comandaId   Int
  description String
  quantity    Int      @default(1)
  unitCents   Int
  createdAt   DateTime @default(now())
  produtoId   Int?
  comanda     Comanda  @relation(fields: [comandaId], references: [id])
  produto     Produto? @relation(fields: [produtoId], references: [id])
}

enum UserRole {
  ADMIN
  USER
}

enum PaymentMethod {
  CASH
  PIX
  CARD
}

enum ProductCategory {
  BEBIDA
  COMIDA
  SNACK
  OUTROS
}
